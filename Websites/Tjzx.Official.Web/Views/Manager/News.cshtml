@section Header{
    <link href="//ued.tjzx.com/css/plugs/pager.min.css?t=20140408" rel="stylesheet" type="text/css" />
}
@using Shoy.Utility.Extend;
@using Tjzx.Official.BLL.Dict;
@{
    ViewBag.Title = "新闻资讯";
}
<div class="m-panel">
    <div class="m-panel-title">
        <ul>
            <li class="active">资讯列表</li>
            <li>发布资讯</li>
        </ul>
    </div>
    <div class="m-panel-item">
        <table class="m-table">
            <caption>资讯列表</caption>
            <colgroup>
                <col class="col-06"/><col /><col class="col-08"/>
                <col class="col-10"/><col class="col-08"/><col class="col-08"/>
                <col class="col-12"/>
            </colgroup>
            <thead>
                <tr>
                    <th>资讯ID</th>
                    <th>资讯标题</th>
                    <th>资讯类别</th>
                    <th>发布时间</th>
                    <th>发布者</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
            <tr>
                <td>kk</td>
                <td class="text-left">kk</td>
                <td>kk</td>
                <td>kk</td>
                <td>kk</td>
                <td>kk</td>
                <td>
                    <a href="">编辑</a>
                    <a href="">删除</a>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="j-pager" data-pager="{count:152}"></div>
    </div>
    <div class="m-panel-item hide">
        <div class="m-form">
            <div class="m-form-group">
                <label class="m-form-label"><em>*</em>资讯标题</label>
                <div class="m-form-controls">
                    <input type="text" class="input-large" name="title" data-valid="{type:'require',msg:'资讯标题不能为空！'}" />
                </div>
            </div>
            <div class="m-form-group">
                <label class="m-form-label"><em>*</em>资讯类型</label>
                <div class="m-form-controls">
                    <select name="type" data-valid="{type:'^[0-9]+$',msg:'请选择类型！'}">
                        <option value="-1">请选择类型</option>
                        @{
                            foreach (NewsType type in Enum.GetValues(typeof (NewsType)))
                            {
                                <option value="@type.GetValue()">@type.GetText()</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="m-form-group">
                <label class="m-form-label">作　　者</label>
                <div class="m-form-controls">
                    <input type="text" name="author" />
                </div>
            </div>
            <div class="m-form-group">
                <label class="m-form-label">出　　处</label>
                <div class="m-form-controls">
                    <input type="text" name="comefrom" />
                </div>
            </div>
            <div class="m-form-group">
                <label class="m-form-label">资讯内容</label>
                <div class="m-form-controls" style="height: 510px">
                    <script type="text/plain" id="content" class="content"></script>
                </div>
            </div>
            <div class="m-form-actions">
                <button type="button" class="btn btn-primary j-release">发布资讯</button>
            </div>
        </div>
    </div>
</div>
@section Footer{
    <script type="text/javascript" src="//ued.tjzx.com/js/tjzx/m/m-base.min.js"></script>
    <script type="text/javascript" src="//ued.tjzx.com/js/plugs/Jq-pager.min.js"></script>
    <script type="text/javascript" src="//ued.tjzx.com/js/plugs/Jq-form.min.js"></script>
    <script type="text/javascript" src="/ueditor/ueditor.config.js" charset="utf-8"></script>
    <script type="text/javascript" src="/ueditor/ueditor.all.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/ueditor/lang/zh-cn/zh-cn.js" charset="utf-8"></script>
    <script type="text/javascript">
        (function ($) {
            window.UEDITOR_CONFIG.autoHeightEnabled = false;
            var editor = UE.getEditor("content");
            //form
            var vForm = $(".m-form").valid();

            $(".m-panel-title")
                .delegate("li", "click", function () {
                    if ($(this).hasClass("active")) return false;
                    var $t = $(this),
                        $lis = $t.parents(".m-panel").find(".m-panel-item"),
                        index = $t.parent().find("li").index($t);
                    $t.addClass("active").siblings("li").removeClass("active");
                    $lis.hide().eq(index).fadeIn();
                    top.window && top.window.SetFrameHeight && top.window.SetFrameHeight();
                    return false;
                });
            $(document)
                .delegate(".j-release", "click", function () {
                    if ($(this).hasClass("disabled") || !vForm.check()) return false;
                    var content = encodeURIComponent(editor.getContent());
                    if (content == "" || content == null) {
                        singer.msg("请填写资讯内容！");
                        return false;
                    }
                    singer.setBtn(this, false);
                    var formData = vForm.json();
                    formData.content = content;
                    singer.getJson("/m/news/add", formData, function (json) {
                        if (json.state) {
                            singer.msg("发布成功！");
                            location.reload(true);
                        } else {
                            singer.msg(json.msg || "操作异常！");
                            singer.setBtn(".j-release", true);
                        }
                    }, function () {
                        singer.setBtn(".j-release", true);
                    });
                    return false;
                });
        })(jQuery);
    </script>
}