/*! shoy.ued version:0.1.0 2014-12-09 23:59:38 */
!function(a,b){b.getJson("/m/diseases/department_list",{state:1},function(b){var c=b.data.list;if(b.state&&c&&c.length>0){for(var d=a("select[name='diseasesDepartmentId'],select[name='CategoryId']"),e="",f=0;f<c.length;f++)e+=singer.format("<option value='{id}'>{name}</option> ",c[f]);d.append(e)}});var c=a(".j-form").valid(),d=a(".s-form").valid({submit:function(){a(".j-search").click()}});c.init(),b.stateArray[0]="隐藏",b.stateArray[1]="显示";var e=new hTemplate({tmp:a("#h-temp").html(),empty:a("#h-empty").html(),container:a(".j-htemplate"),size:15,pager:a(".h-pager"),pageClick:function(a){f(a-1)},filter:function(a){return a.links='<a href="#" class="j-edit">编辑</a>',0==a.state?a.links+=singer.format('<a href="#" class="j-state" data-state="1">{0}</a>',b.stateArray[1]):1==a.state&&(a.links+=singer.format('<a href="#" class="j-state" data-state="0">{0}</a>',b.stateArray[0])),a},complete:function(){b.setFrameHeight()}}),f=function(c){var f=d.json(),g=a(this);singer.mix(f,{page:c}),b.getJson("/m/diseases/list",f,function(c){c.state&&(e.bind(c.data.list,c.data.count),a(".m-table caption em").html(c.data.count)),g.hasClass("btn")&&b.setBtn(g,!0)},function(){e.bind()})},g=function(d){return!d||0>=d?(c.reset(),h.setContent(""),!1):void b.getJson("/m/diseases/item",{id:d},function(d){return d.state?(a(".m-panel-title li").removeClass("active"),a(".m-panel-title ul").append('<li class="m-panel-add active">编辑疾病</li>'),a(".j-back").show(),c.bind(d.data),h.setContent(d.data.diseasesDescription),a(".m-panel-item").hide().eq(1).fadeIn(),b.setFrameHeight(),!1):(b.msg(d.msg||"获取疾病信息失败！"),!1)})};f(0),window.UEDITOR_CONFIG.autoHeightEnabled=!1;var h=UE.getEditor("content");"#send"===location.hash&&a(".m-panel-title li:eq(1)").click(),a(".j-htemplate").delegate(".j-send","click",function(){return a(".m-panel-title li:eq(1)").click(),!1});var i=["Gray","Green"];a(document).delegate(".m-panel-title li:eq(1)","click.form",function(){g()}).delegate(".j-search","click",function(){return a(this).hasClass("disabled")?!1:(b.setBtn(this,!1),f.call(this,0),!1)}).delegate(".j-submit","click",function(){if(a(this).hasClass("disabled")||!c.check())return!1;var d=encodeURIComponent(h.getContent());if(""==d||null==d)return b.msg("请填写资讯内容！"),!1;b.setBtn(this,!1);var e=c.json();return e.diseasesDescription=d,b.getJson("/m/diseases/add",e,function(a){a.state?b.msg(e.diseasesId>0?"编辑成功！":"添加成功！","reload"):(b.msg(a.msg||"操作异常！"),b.setBtn(".j-submit",!0))},function(){b.setBtn(".j-submit",!0)}),!1}).delegate(".j-edit","click",function(){var b=a(this).parents("tr").data("id");return g(b),!1}).delegate(".j-state","click",function(){var c=a(this),d=c.parents("tr").data("id"),e=c.data("state");return d&&""!==e?(b.setStateBtn.call(c,!1),b.getJson("/m/diseases/updateState",{id:d,state:e},function(a){if(a.state){c.parent().prev().html(singer.format('<span style="color:{color}">已{text}</font>',{color:i[e],text:b.stateArray[e+""]}));var d=Math.abs(e-1);b.setStateBtn.call(c,a,d)}else b.setStateBtn.call(c,a,e)}),!1):!1}).delegate(".j-delete","click",function(){var c=a(this).parents("tr").data("id");return confirm("确认删除该疾病？")?(b.getJson("/m/diseases/delete",{id:c},function(a){a.state?(b.msg(a.msg||"删除成功！"),location.reload(!0)):b.msg(a.msg||"删除失败，请稍候重试！")}),!1):!1}).delegate(".j-restore","click",function(){var c=a(this).parents("tr").data("id");return confirm("确认还原该疾病？")?(b.getJson("/m/diseases/restore",{id:c},function(a){a.state?(b.msg(a.msg||"还原成功！"),location.reload(!0)):b.msg(a.msg||"还原失败，请稍候重试！")}),!1):!1})}(jQuery,TJZX);